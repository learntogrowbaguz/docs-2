
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="https://docs.iden3.io/protocol/zklogin/" rel="canonical"/>
<link href="../../favicon.ico" rel="icon"/>
<meta content="mkdocs-1.2.2, mkdocs-material-7.3.2" name="generator"/>
<title>Login protocol - Iden3 Documentation</title>
<link href="../../assets/stylesheets/main.24c991ad.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.3f5d1f46.min.css" rel="stylesheet"/>
<meta content="#000000" name="theme-color"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
</head>
<body data-md-color-accent="" data-md-color-primary="black" data-md-color-scheme="" dir="ltr">
<script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#server-side-login-zkp-login">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--lifted" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Iden3 Documentation" class="md-header__button md-logo" data-md-component="logo" href="../.." title="Iden3 Documentation">
<img alt="logo" src="../../logo.svg"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Iden3 Documentation
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Login protocol
            
          </span>
</div>
</div>
</div>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/iden3/docs/" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
</nav>
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-tabs__inner md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../basics/introduction/">
        The basics
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../spec/">
        Iden3 protocol
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link md-tabs__link--active" href="./">
        Services and protocols
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../circuits/">
      Circuits
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../circom-snarkjs/">
      Circom / snarkjs
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../publications/publications/">
      Publications
    </a>
</li>
</ul>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Iden3 Documentation" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="Iden3 Documentation">
<img alt="logo" src="../../logo.svg"/>
</a>
    Iden3 Documentation
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/iden3/docs/" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" id="__nav_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_1">
          The basics
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="The basics" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_1">
<span class="md-nav__icon md-icon"></span>
          The basics
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../basics/introduction/">
        Introduction
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../basics/key-concepts/">
        Key concepts
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../basics/getting-started/">
        Getting started
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2">
          Iden3 protocol
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Iden3 protocol" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
          Iden3 protocol
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../spec/">
        Iden3 protocol specs
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2" id="__nav_2_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_2">
          Claim
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Claim" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_2">
<span class="md-nav__icon md-icon"></span>
          Claim
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../claims-structure/">
        Structure
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../bjjkey/">
        AuthBJJCredential
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3">
          Services and protocols
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Services and protocols" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
          Services and protocols
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          Login protocol
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        Login protocol
      </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#introduction">
    Introduction
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#authentication-based-on-zero-knowledge-proof">
    Authentication based on zero-knowledge proof
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#prerequisite">
    Prerequisite
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#integration">
    Integration
  </a>
<nav aria-label="Integration" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#back-end">
    Back-end
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#front-end">
    Front-end
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#tutorial-simple-go-app">
    Tutorial simple go app
  </a>
<nav aria-label="Tutorial simple go app" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#auth-package">
    Auth package
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#sign-in">
    Sign in
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#callback">
    Callback
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#verification-procedure-details">
    Verification procedure details
  </a>
<nav aria-label="Verification procedure details" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#zero-knowledge-proof-verification">
    Zero-knowledge proof verification
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#extraction-of-metadata">
    Extraction of metadata
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#verification-of-user-identity-states">
    Verification of user identity states
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#verification-of-circuits-public-signals">
    Verification of circuits public signals
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../querylanguage/">
        Proof Query language
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../circuits/">
        Circuits
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../circom-snarkjs/">
        Circom / snarkjs
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../publications/publications/">
        Publications
      </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#introduction">
    Introduction
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#authentication-based-on-zero-knowledge-proof">
    Authentication based on zero-knowledge proof
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#prerequisite">
    Prerequisite
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#integration">
    Integration
  </a>
<nav aria-label="Integration" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#back-end">
    Back-end
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#front-end">
    Front-end
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#tutorial-simple-go-app">
    Tutorial simple go app
  </a>
<nav aria-label="Tutorial simple go app" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#auth-package">
    Auth package
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#sign-in">
    Sign in
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#callback">
    Callback
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#verification-procedure-details">
    Verification procedure details
  </a>
<nav aria-label="Verification procedure details" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#zero-knowledge-proof-verification">
    Zero-knowledge proof verification
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#extraction-of-metadata">
    Extraction of metadata
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#verification-of-user-identity-states">
    Verification of user identity states
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#verification-of-circuits-public-signals">
    Verification of circuits public signals
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://github.com/iden3/docs/edit/master/docs/protocol/zklogin.md" title="Edit this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"></path></svg>
</a>
<h1 id="server-side-login-zkp-login">Server-side login (ZKP Login)</h1>
<h2 id="introduction"><strong>Introduction</strong></h2>
<p>Iden3 is SSI solution that allows users to leverage their pre-existing validated identities to prove they are who they claim to be based on zero-knowledge proofs. One of the direct applications of iden3’s technology is to allow web applications to reuse these identities for login into their portals.</p>
<p><img alt="Login workflow" src="../../imgs/login.png"/></p>
<p>Login workflow</p>
<p>In a simple example application request a user identifier, which is done through zero-knowledge proof (zk proof) generation.</p>
<p>The server generates an authentication request</p>
<p><em>Auth request</em></p>
<pre><code class="language-json">    {
      "type": "https://iden3-communication.io/authorization-request/v1",
      "data": {
        "callbackUrl": "https://test.com/callbackurl",
        "audience": "1125GJqgw6YEsKFwj63GY87MMxPL9kwDKxPUiwMLNZ",
        "scope": [
            {
              "circuit_id": "auth",
              "type": "zeroknowledge",
              "rules": {
                  "challenge": 12345
              }
          }
       ]
      }
    }
</code></pre>
<p>This is an example of an authorization request. Scope field is a set of objects describes an array of proofs that must be generated on a user device and presented later.
Each scope member has a unique definition of a circuit that must be used and rules (public inputs) that must be applied.</p>
<p>This message can be delivered to user through different communication channels: QR code, email, deep-linking, .etc .
On scan mobile has to implement:</p>
<ol>
<li>Parsing the auth request and understand which proof handler it should use</li>
<li>Resolve verifier identifier if it’s needed.</li>
<li>Generate proofs using a specific handler. It can be signature proof or zero-knowledge</li>
<li>Prepare an authentication response message.</li>
</ol>
<p>On mobile user generates ZK proof using <a href="https://github.com/iden3/circuits/blob/master/circuits/authentication.circom">auth</a> circuit that will prove identity ownership, and send the response to the callback URL</p>
<p><em>Auth response</em></p>
<pre><code class="language-json">{
  "type": "https://iden3-communication.io/authorization-response/v1",
  "data": {
    "scope": [
      {
        "type": "zeroknowledge",
        "circuit_id": "auth",
        "pub_signals": [
          "371135506535866236563870411357090963344408827476607986362864968105378316288",
          "12345",
          "16751774198505232045539489584666775489135471631443877047826295522719290880931"
        ],
        "proof_data": {
          "pi_a": [
            "8286889681087188684411199510889276918687181609540093440568310458198317956303",
            "20120810686068956496055592376395897424117861934161580256832624025185006492545",
            "1"
          ],
          "pi_b": [
            [
              "8781021494687726640921078755116610543888920881180197598360798979078295904948",
              "19202155147447713148677957576892776380573753514701598304555554559013661311518"
            ],
            [
              "15726655173394887666308034684678118482468533753607200826879522418086507576197",
              "16663572050292231627606042532825469225281493999513959929720171494729819874292"
            ],
            [
              "1",
              "0"
            ]
          ],
          "pi_c": [
            "9723779257940517259310236863517792034982122114581325631102251752415874164616",
            "3242951480985471018890459433562773969741463856458716743271162635077379852479",
            "1"
          ],
          "protocol": "groth16"
        }
      }
    ]
  }
}
</code></pre>
<p>Client after receiving authorization response performs  verification procedure:</p>
<ol>
<li>Zero-knowledge proof verification</li>
<li>Extraction of metadata: (auth and circuit-specific)</li>
<li>Verification of user identity states</li>
<li>Verification of circuits public inputs (e.g. issuer state)</li>
</ol>
<h2 id="authentication-based-on-zero-knowledge-proof">Authentication based on zero-knowledge proof</h2>
<p>ZK proof is based on <a href="https://docs.circom.io/">Circom 2.0</a> language.</p>
<p>Auth circuit repository: <a href="https://github.com/iden3/circuits/blob/master/circuits/authentication.circom">https://github.com/iden3/circuits/blob/master/circuits/authentication.circom</a></p>
<p>The circuit verifies that the user is the owner of the identity and his auth key is not revoked in the provided user state.</p>
<h2 id="prerequisite">Prerequisite</h2>
<p>Identity wallet installed</p>
<h2 id="integration">Integration</h2>
<h3 id="back-end">Back-end</h3>
<p>Generate auth request</p>
<pre><code class="language-go">request := auth.CreateAuthorizationRequest("&lt;challenge&gt;","&lt;verifier identity|app-url&gt;", "&lt;callbackURI&gt;") // create auth request
</code></pre>
<p>Validate auth request</p>
<pre><code class="language-go">// unpack raw message
message, err := packer.Unpack(msgBytes) 
// call library to verify zkp proofs
err = auth.VerifyProofs(message)  
// extract metadata
token, err := auth.ExtractMetadata(message)
// verify state
stateInfo, err := token.VerifyState(ctx.Background(),"&lt; rpc url &gt;", "&lt; state contract address &gt;")

</code></pre>
<p>In future releases of auth library the verification procedure will be simplified and optimized for verifier.</p>
<h3 id="front-end">Front-end</h3>
<p>On the front-end side, you need to embed a button to start the login process. After the button is pressed, the front-end makes a request to the back-end to generate an authentication request and displays it in QR code. When the user scans the QR code, the phone generates ZK proof and sends the proof to the call-back URL from QR-code.
Currently, we are working on js-iden3-auth library.</p>
<h2 id="tutorial-simple-go-app">Tutorial simple go app</h2>
<p>We need a simple web server with two endpoint</p>
<ul>
<li>GET /sign-in should return auth request</li>
<li>POST /call-back endpoint to receive callback request from the phone and validate the request</li>
</ul>
<p>Let’s write a simple web-server</p>
<pre><code class="language-go">func main() {

    http.HandleFunc("/sign-in", signIn)
    http.HandleFunc("/call-back", callBack)

    http.ListenAndServe(":8001", nil)
}

func signIn(w http.ResponseWriter, req *http.Request) {

}

func callBack(w http.ResponseWriter, req *http.Request) {

}
</code></pre>
<h3 id="auth-package">Auth package</h3>
<p>Add authorization package to the project.</p>
<pre><code class="language-go">go get https://github.com/iden3/go-iden3-auth
</code></pre>
<h3 id="sign-in">Sign in</h3>
<p>To generate a ZK auth request we need a callback URL, to this URL we will receive a response from the mobile application with an authentication response. And verifier identity [do we really need this identity?]</p>
<p>go-iden3-auth library contains a method for generating the authentication request</p>
<p>[Descrition]</p>
<pre><code class="language-go">func CreateAuthorizationRequest(challenge int64, aud, callbackURL string) *types.AuthorizationMessageRequest
</code></pre>
<p>Now we are ready to generate auth request</p>
<pre><code class="language-go">const CallBackUrl      = "http:localhost:8001/call-back"
const VerifierIdentity = "1125GJqgw6YEsKFwj63GY87MMxPL9kwDKxPUiwMLNZ"

func signIn(w http.ResponseWriter, req *http.Request) {

    request := auth.CreateAuthorizationRequest(10, VerifierIdentity, callBackURI)

    msgBytes, _ := json.Marshal(request) // error handling ommited for simplification

    w.Header().Set("Content-Type", "application/json")
    w.WriteHeader(http.StatusOK)
    w.Write(msgBytes)
}
</code></pre>
<h3 id="callback">Callback</h3>
<p>When we receive a callback request with ZK response we have to do a couple of things to validate this response</p>
<ul>
<li>Validate ZK proof, and make sure that the proof is valid</li>
<li>Validate identity state on-chain, we are doing it to verify that user identity state is valid and his auth keys are not revoked</li>
</ul>
<p>First, let’s validate ZK proof, for this we have a function</p>
<pre><code class="language-go">func VerifyProofs(message types.Message) (err error)
</code></pre>
<p>but before we can call it we need to unpack raw bytes to a message. Packer can be used to process encrypted message in future releases.</p>
<pre><code class="language-go">p := &amp;packer.PlainMessagePacker{}
// Unpack msg
message, _ := p.Unpack(msgBytes)    
// verify zkp
proofErr := auth.VerifyProofs(message)
</code></pre>
<p>Now ZK proof is verified and we can check identity status on chain</p>
<p>Fist we need access to RPC URL, and address of identity smart-contract</p>
<pre><code class="language-go">const rpc = "https://polygon-mumbai.infura.io/v3/&lt;your-token&gt;"
const IdentityContract = "0x3e95a7B12e8905E01126E1beA3F1a52D1624A725"
</code></pre>
<p>Before we can verify a state, we need to extract metadata, and then verify it on chain</p>
<pre><code class="language-go">token, _:= auth.ExtractMetadata(message)

// verify match identifier with the state on chain
stateInfo, err := token.VerifyState(ctx, rpc, IdentityContract)
</code></pre>
<h2 id="verification-procedure-details">Verification procedure details</h2>
<h3 id="zero-knowledge-proof-verification">Zero-knowledge proof verification</h3>
<blockquote>
<p>Groth16 proof are supported now by auth library
</p>
</blockquote>
<p>Verification keys for circuits are known by the library itself. In the future, they can be resolved from circuits registries.</p>
<h3 id="extraction-of-metadata">Extraction of metadata</h3>
<p>Each circuit has a schema of its public inputs that links the public signal name to its position in the resulted array.</p>
<p>This allows extracting user identifiers and challenges for authentication from proof.</p>
<p>Other signals are added to the user token ( scope field) as attributes of a specific circuit.</p>
<p>Circuit public signals schemas are known by this library or can be retrieved from some registry.</p>
<h3 id="verification-of-user-identity-states">Verification of user identity states</h3>
<p>The blockchain verification algorithm is  used</p>
<ol>
<li>
<p>Get state from the blockchain (address of id state contract and URL must be provided by the caller of the library):</p>
<ol>
<li>Empty state is returned - it means that identity state hasn’t been updated or updated state hasn’t been published. We need to compare id and state. If they are different it’s not a genesis state of identity then it’s not valid.</li>
<li>The non-empty state is returned and equals to the state in provided proof which means that the user state is fresh enough and we work with the latest user state.</li>
<li>The non-empty state is returned and it’s not equal to the state that the user has provided. Gets the time of the state transition. The verification party can make a decision if it can accept this state based on that time frame</li>
</ol>
</li>
<li>
<p>Verification party can make a decision to accept provided state or not.</p>
</li>
</ol>
<h3 id="verification-of-circuits-public-signals">Verification of circuits public signals</h3>
<p>It can be different kind of verification e.g.
1. Check of that issuer states of provided claim proofs are published on the blockchain (same as for identity state)
2. Check of query signals, so claim schema and specific values can be verified.</p>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: AuthBJJCredential" class="md-footer__link md-footer__link--prev" href="../bjjkey/" rel="prev">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</div>
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Previous
              </span>
              AuthBJJCredential
            </div>
</div>
</a>
<a aria-label="Next: Proof Query language" class="md-footer__link md-footer__link--next" href="../querylanguage/" rel="next">
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Next
              </span>
              Proof Query language
            </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
            Material for MkDocs
          </a>
</div>
<div class="md-footer-social">
<a class="md-footer-social__link" href="https://t.me/iden3io" rel="noopener" target="_blank" title="t.me">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><path d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm121.8 169.9-40.7 191.8c-3 13.6-11.1 16.9-22.4 10.5l-62-45.7-29.9 28.8c-3.3 3.3-6.1 6.1-12.5 6.1l4.4-63.1 114.9-103.8c5-4.4-1.1-6.9-7.7-2.5l-142 89.4-61.2-19.1c-13.3-4.2-13.6-13.3 2.8-19.7l239.1-92.2c11.1-4 20.8 2.7 17.2 19.5z"></path></svg>
</a>
<a class="md-footer-social__link" href="https://github.com/iden3/docs" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
</a>
<a class="md-footer-social__link" href="https://iden3.io/" rel="noopener" target="_blank" title="iden3.io">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M0 3.75C0 2.784.784 2 1.75 2h20.5c.966 0 1.75.784 1.75 1.75v16.5A1.75 1.75 0 0 1 22.25 22H1.75A1.75 1.75 0 0 1 0 20.25V3.75zm1.75-.25a.25.25 0 0 0-.25.25V5.5h4v-2H1.75zM7 3.5v2h4v-2H7zm5.5 0v2h10V3.75a.25.25 0 0 0-.25-.25H12.5zm10 3.5h-21v13.25c0 .138.112.25.25.25h20.5a.25.25 0 0 0 .25-.25V7z" fill-rule="evenodd"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.tracking"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.e99e714c.min.js", "version": null}</script>
<script src="../../assets/javascripts/bundle.bc35569b.min.js"></script>
<script src="../../javascripts/mathjax.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</body>
</html>