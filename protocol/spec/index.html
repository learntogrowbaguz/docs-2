
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="https://docs.iden3.io/protocol/spec/" rel="canonical"/>
<link href="../../favicon.ico" rel="icon"/>
<meta content="mkdocs-1.2.2, mkdocs-material-7.3.2" name="generator"/>
<title>Iden3 protocol specs - Iden3 Documentation</title>
<link href="../../assets/stylesheets/main.24c991ad.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.3f5d1f46.min.css" rel="stylesheet"/>
<meta content="#000000" name="theme-color"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
</head>
<body data-md-color-accent="" data-md-color-primary="black" data-md-color-scheme="" dir="ltr">
<script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#iden3-protocol-specs-version-0">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--lifted" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Iden3 Documentation" class="md-header__button md-logo" data-md-component="logo" href="../.." title="Iden3 Documentation">
<img alt="logo" src="../../logo.svg"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Iden3 Documentation
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Iden3 protocol specs
            
          </span>
</div>
</div>
</div>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/iden3/docs/" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
</nav>
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-tabs__inner md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../basics/introduction/">
        The basics
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link md-tabs__link--active" href="./">
        Iden3 protocol
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../zklogin/">
        Services and protocols
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../circuits/">
      Circuits
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../circom-snarkjs/">
      Circom / snarkjs
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../publications/publications/">
      Publications
    </a>
</li>
</ul>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Iden3 Documentation" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="Iden3 Documentation">
<img alt="logo" src="../../logo.svg"/>
</a>
    Iden3 Documentation
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/iden3/docs/" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" id="__nav_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_1">
          The basics
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="The basics" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_1">
<span class="md-nav__icon md-icon"></span>
          The basics
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../basics/introduction/">
        Introduction
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../basics/key-concepts/">
        Key concepts
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../basics/getting-started/">
        Getting started
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2">
          Iden3 protocol
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Iden3 protocol" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
          Iden3 protocol
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          Iden3 protocol specs
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        Iden3 protocol specs
      </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#basis">
    Basis
  </a>
<nav aria-label="Basis" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#glossary">
    Glossary
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#merkletree">
    MerkleTree
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#zero-knowledge-proof-zkp">
    Zero-Knowledge proof (ZKP)
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#claims">
    Claims
  </a>
<nav aria-label="Claims" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#definition">
    Definition
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#properties">
    Properties
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#structure">
    Structure
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#reliability-of-a-claim-content">
    Reliability of a claim content
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#keys">
    Keys
  </a>
<nav aria-label="Keys" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#types-of-keys">
    Types of keys
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#identity">
    Identity
  </a>
<nav aria-label="Identity" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#definition_1">
    Definition
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#genesis-id">
    Genesis ID
  </a>
<nav aria-label="Genesis ID" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#description">
    Description
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#identifier-format">
    Identifier format
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#identity-state">
    Identity state
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#identity-state-transition-function">
    Identity state transition function
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#identity-ownership">
    Identity Ownership
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#identity-key-rotation">
    Identity key rotation
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#identity-revocation">
    Identity Revocation
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#interaction-between-identity-and-claims">
    Interaction between Identity and Claims
  </a>
<nav aria-label="Interaction between Identity and Claims" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#identity-state-update">
    Identity State Update
  </a>
<nav aria-label="Identity State Update" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#publish-claims">
    Publish Claims
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#revocation-tree">
    Revocation tree
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#revoke-claims">
    Revoke Claims
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#update-claims">
    Update Claims
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#prove-claims-credentials">
    Prove Claims (Credentials)
  </a>
<nav aria-label="Prove Claims (Credentials)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#prove-that-a-claim-was-issued-at-time-at-least-t">
    Prove that a claim was issued at time at least t
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#prove-that-the-claim-is-currently-valid">
    Prove that the claim is currently valid
  </a>
<nav aria-label="Prove that the claim is currently valid" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#prove-that-a-claim-hasnt-been-recently-revoked">
    Prove that a claim hasn't been recently revoked
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#proof-of-last-version">
    Proof of last version
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#proof-of-non-expiration">
    Proof of non-Expiration
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#zero-knowledge-proof-of-valid-credential">
    Zero-Knowledge proof of valid Credential
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#identities-communications">
    Identities Communications
  </a>
<nav aria-label="Identities Communications" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#issuer-holder-credential-request-procedure">
    Issuer - Holder (Credential Request procedure)
  </a>
<nav aria-label="Issuer - Holder (Credential Request procedure)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#direct-claims">
    Direct Claims
  </a>
<nav aria-label="Direct Claims" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#indirect-claims">
    Indirect Claims
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#holder-verifier">
    Holder - Verifier
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2" id="__nav_2_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_2">
          Claim
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Claim" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_2">
<span class="md-nav__icon md-icon"></span>
          Claim
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../claims-structure/">
        Structure
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../bjjkey/">
        AuthBJJCredential
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3">
          Services and protocols
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Services and protocols" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
          Services and protocols
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../zklogin/">
        Login protocol
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../querylanguage/">
        Proof Query language
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../circuits/">
        Circuits
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../circom-snarkjs/">
        Circom / snarkjs
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../publications/publications/">
        Publications
      </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#basis">
    Basis
  </a>
<nav aria-label="Basis" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#glossary">
    Glossary
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#merkletree">
    MerkleTree
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#zero-knowledge-proof-zkp">
    Zero-Knowledge proof (ZKP)
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#claims">
    Claims
  </a>
<nav aria-label="Claims" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#definition">
    Definition
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#properties">
    Properties
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#structure">
    Structure
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#reliability-of-a-claim-content">
    Reliability of a claim content
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#keys">
    Keys
  </a>
<nav aria-label="Keys" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#types-of-keys">
    Types of keys
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#identity">
    Identity
  </a>
<nav aria-label="Identity" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#definition_1">
    Definition
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#genesis-id">
    Genesis ID
  </a>
<nav aria-label="Genesis ID" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#description">
    Description
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#identifier-format">
    Identifier format
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#identity-state">
    Identity state
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#identity-state-transition-function">
    Identity state transition function
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#identity-ownership">
    Identity Ownership
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#identity-key-rotation">
    Identity key rotation
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#identity-revocation">
    Identity Revocation
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#interaction-between-identity-and-claims">
    Interaction between Identity and Claims
  </a>
<nav aria-label="Interaction between Identity and Claims" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#identity-state-update">
    Identity State Update
  </a>
<nav aria-label="Identity State Update" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#publish-claims">
    Publish Claims
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#revocation-tree">
    Revocation tree
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#revoke-claims">
    Revoke Claims
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#update-claims">
    Update Claims
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#prove-claims-credentials">
    Prove Claims (Credentials)
  </a>
<nav aria-label="Prove Claims (Credentials)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#prove-that-a-claim-was-issued-at-time-at-least-t">
    Prove that a claim was issued at time at least t
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#prove-that-the-claim-is-currently-valid">
    Prove that the claim is currently valid
  </a>
<nav aria-label="Prove that the claim is currently valid" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#prove-that-a-claim-hasnt-been-recently-revoked">
    Prove that a claim hasn't been recently revoked
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#proof-of-last-version">
    Proof of last version
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#proof-of-non-expiration">
    Proof of non-Expiration
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#zero-knowledge-proof-of-valid-credential">
    Zero-Knowledge proof of valid Credential
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#identities-communications">
    Identities Communications
  </a>
<nav aria-label="Identities Communications" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#issuer-holder-credential-request-procedure">
    Issuer - Holder (Credential Request procedure)
  </a>
<nav aria-label="Issuer - Holder (Credential Request procedure)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#direct-claims">
    Direct Claims
  </a>
<nav aria-label="Direct Claims" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#indirect-claims">
    Indirect Claims
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#holder-verifier">
    Holder - Verifier
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://github.com/iden3/docs/edit/master/docs/protocol/spec.md" title="Edit this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"></path></svg>
</a>
<h1 id="iden3-protocol-specs-version-0">Iden3 protocol specs (version 0)</h1>
<blockquote>
<p>These specifications are still being built and updated regularly. Consider it work in progress.</p>
</blockquote>
<h2 id="basis">Basis</h2>
<h3 id="glossary">Glossary</h3>
<ul>
<li>Issuer: an actor who makes a claim.</li>
<li>Holder: an actor who has received a claim.</li>
<li>Verifier: an actor who verifies if the content of a claim is issued by a specific identity and held by another specific identity.</li>
<li>Credential: data that is needed to prove that a claim is issued by a specific identity and held by another specific identity. This data is composed of a <strong>claim and a proof</strong>.</li>
</ul>
<h3 id="merkletree">MerkleTree</h3>
<p>A Merkle tree (MT) or hash tree is a cryptographically verifiable data structure where every "leaf" node of the tree contains the cryptographic hash of a data block, and every non-leaf node contains the cryptographic hash of its child nodes.</p>
<p>The MTs used in the protocol has a few particularities:
- Binary: each node can only have two children.
- Sparse and Deterministic: the contained data is indexed, and each data block is placed at the leaf that corresponds to that data block's index, so insert order doesn't influence the final Merkle Tree Root. This also means that some nodes are empty.
- ZK friendly: the used hash function, <a href="https://www.poseidon-hash.info/">poseidon</a>, plays well with the Zero-Knowledge proofs (ZKP) used in different parts of the protocol.</p>
<p>In order to ensure that these particularities are respected and to have a history of all changes that occurred on different trees (without revealing the actual content stored in the leaves), <strong>the root of each MT is indirectly stored on the blockchain</strong>. EVM-based blockchains are chosen for this purpose.</p>
<p>The <code>Merkle Tree</code> specification is defined in <a href="https://github.com/iden3/iden3-docs/blob/master/source/docs/MerkleTree.pdf">this document</a>. In the future, the MT implementation could be changed.</p>
<h3 id="zero-knowledge-proof-zkp">Zero-Knowledge proof (ZKP)</h3>
<p>In cryptography, a zero-knowledge proof is a method by which one party (the prover) can prove to another party (the verifier) that prover knows a value x that fulfills some constraints, without revealing any information apart from the fact that he/she knows the value x.</p>
<p>The technologies that implement these methods are evolving rapidly. As of now, the protocol uses zkSNARKs Groth16, but in the future, the zk protocol could be changed.
zkSNARK stands for "Zero-Knowledge Succinct Non-Interactive Argument of Knowledge", and have the following properties:</p>
<ul>
<li>Non-interactive: with a single message (credential) from the prover, the verifier can verify the proof.  This is good because it allows sending proofs to a smart contract that can verify them immediately.</li>
<li>Efficient verification: it's computationally efficient to verify proofs, both in terms of size and operations. This is good for the protocol because verification happens on the blockchain with its inherent costs.</li>
<li>Heavy proof generation: generating a proof is computationally very expensive and can be time-consuming even with powerful hardware.</li>
<li>Setup: a pre-existing setup between the prover and verifier is required for the construction of zkSNARKs. In order to ensure that the verifier can not cheat one has to be sure that the keys used for the setup were destroyed. There are protocols to ensure that, resulting in a "trusted setup".</li>
</ul>
<p>More technical information about zkSNARKs on <a href="https://medium.com/@VitalikButerin/zk-snarks-under-the-hood-b33151a013f6">this article</a> by Vitalik Buterin.</p>
<h2 id="claims">Claims</h2>
<h3 id="definition">Definition</h3>
<p>A claim is a statement made by one identity about another identity or itself.
Each claim is composed of two parts: index and value part.
Claims are stored in the leaves of an MT. The index is hashed and used to determine in which leaf position the value of the claim will be stored.</p>
<p>A special transition validation functions can be used to restrict how leaves are stored in the MT, e.g. make the MT append-only, so that leaves can't be updated or deleted, just added.</p>
<h3 id="properties">Properties</h3>
<ul>
<li>It's impossible to generate a proof of a statement on behalf of an identity without its consent.</li>
<li>Claims can be revoked.</li>
<li>Claims can be updated by creating new versions. When a claim is revoked, no further versions can be made.  Claims can be set to be updatable or not with a flag (See claim structure).</li>
</ul>
<div class="mermaid">graph LR
    revoked(Revoked claim)
    no-claim--&gt;v0
    v0--&gt;v1
    v1-.-&gt;vN
    vN--&gt;vN1
    vN1--&gt;revoked

    no-claim(No claim)
    v0(Claim v0)
    v1(Claim v1)
    vN(Claim vN)
    vN1(Claim vN+1)
</div>
<ul>
<li>Claims can be verified. This means that it's possible to demonstrate cryptographically that a given claim is:<ul>
<li>Issued by a specific identity.</li>
<li>Not revoked.</li>
<li>Is of the last version of that claim if it's updatable.</li>
</ul>
</li>
<li>There are two types of claims regarding destination<ul>
<li>Claims about self properties. Example: Operational Key, Ethereum Address, etc.</li>
<li>Claims about another identity property<ul>
<li>(another) identity has a property: directional relation between an identity and a property (See claim structure: identity stored in hIndex, i_1)</li>
<li>property is owned by (another) identity: directional relation between a property and an identity (See claim structure: identity stored in hValue, v_1)</li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>NOTE: Some of these properties are only guaranteed by a transition validation function (explained above in this document).</p>
</blockquote>
<h3 id="structure">Structure</h3>
<pre><code>h_i = H(i_0, i_1, i_2, i_3)
h_v = H(v_0, v_1, v_2, v_3)
h_t = H(h_i, h_v)
</code></pre>
<div class="mermaid">graph TD
Hi--&gt;i0
Hi--&gt;i1
Hi--&gt;i2
Hi--&gt;i3

Hv--&gt;v0
Hv--&gt;v1
Hv--&gt;v2
Hv--&gt;v3

Ht--&gt;Hi
Ht--&gt;Hv
</div>
<pre><code>Index:
 i_0: [ 128 bits ] claim schema
      [ 32 bits ] header flags
          [3] Subject:
            000: A.1 Self
            001: invalid
            010: A.2.i OtherIden Index
            011: A.2.v OtherIden Value
            100: B.i Object Index
            101: B.v Object Value
          [1] Expiration: bool
          [1] Updatable: bool
          [27] 0
      [ 32 bits ] version (optional?)
      [ 61 bits ] 0 - reserved for future use
 i_1: [ 248 bits] identity (case b) (optional)
      [  5 bits ] 0
 i_2: [ 253 bits] 0
 i_3: [ 253 bits] 0
Value:
 v_0: [ 64 bits ]  revocation nonce
         [ 64 bits ]  expiration date (optional)
         [ 125 bits] 0 - reserved
 v_1: [ 248 bits] identity (case c) (optional)
        [  5 bits ] 0
 v_2: [ 253 bits] 0
 v_3: [ 253 bits] 0
</code></pre>
<h3 id="reliability-of-a-claim-content">Reliability of a claim content</h3>
<p>The correctness of what is said in a claim is not verifiable by the protocol, since every identity is free to claim whatever they want. Since it's possible to know which identity issued each claim, the trust / reputation that the issuer has can affect its credibility.</p>
<p>However, the protocol can guarantee exclusivity: there cannot be two claims with the same index. So it's impossible that an identity claims that a particular property (index part of the claim) is linked to two different identities (value part of the claim) at the same time.</p>
<h2 id="keys">Keys</h2>
<p>Keys are cryptographic elements that can be used to sign data. In the protocol keys are used to authenticate certain interactions.</p>
<p>These keys require the authorization of the identity who owns them to be used. This is done by adding a claim with a specific schema, linking the key(s) with the identity. </p>
<p>This way each time that a key is used for signing, the identity can (and must) prove the ownership of that key and the fact that the key is not revoked.</p>
<!-- ==**TODO**==
== - explain what role the keys play in the iden3 protocol. Authenticate! explain that the keys are used to sign to authenticate an identity ==
== - and that in the case of zero knowledge it is not done as it would be done 'traditionally', but that the zero knowledge proof itself already shows that the sender knows the private key == -->
<h3 id="types-of-keys">Types of keys</h3>
<ul>
<li>Baby Jubjub: used for authentication. This type of key is designed to be efficient when working with zkSNARKs.
  The <code>Baby Jubjub Elliptic Curve</code> specification is defined in <a href="https://github.com/iden3/iden3-docs/blob/master/source/docs/Baby-Jubjub.pdf">this document</a>.</li>
</ul>
<h2 id="identity">Identity</h2>
<h3 id="definition_1">Definition</h3>
<p>An <code>identity</code> is characterized by the claims, that the identity has issued, and the claims, that the identity has received from other identities, in other words: an identity is built by what the identity has said, and what others have said about the identity.</p>
<p>Each claim that identity issues can be cryptographically proved and verified, ensuring that the claim existed under identity at a certain timestamp.</p>
<div class="mermaid">graph TD
    Root--&gt;A
    Root--&gt;B

    A--&gt;C
    A--&gt;D
    B--&gt;E
    B--&gt;F

    C--&gt;G
    C--&gt;H
    D--&gt;I
    D--&gt;J
    E--&gt;K
    E--&gt;L
    F--&gt;M
    F--&gt;N

    G["claim"]
    H["claim"]
    I["claim"]
    J["claim"]
    K["claim"]
    L["claim"]
    M["claim"]
    N["claim"]
</div>
<p>To accomplish this (and other properties covered in this document), identities are built by <a href="#MerkleTree">MerkleTrees</a>, where the claims are placed as the leaves, and the <code>Root</code> is published (indirectly through identity state) in the blockchain. With this construction, the identities can issue, update and revoke claims.</p>
<p>The protocol construction is designed to enable Zero-Knowledge features, which means for example that identities have the ability to prove with Zero-Knowledge the ownership of properties of claims in issued and received claims among other capabilities and verify that claim is not revoked.</p>
<h3 id="genesis-id">Genesis ID</h3>
<h4 id="description">Description</h4>
<p>Each identity has a unique <code>identifier</code> that is determined by the initial identity state (hash of its MerkleTree roots), called <code>Genesis ID</code>, under which the initial claims are placed, that are the ones contained in the initial state of the identity.</p>
<!-- TODO: For the initial implementation of the protocol, the Genesis Claims Tree will contain at least a [claim of authorization of the Operational key](#link-to-the-spec-of-the-claim-once-is-done), that allows operating in the name of identity. -->
<p>For the initial implementation of the protocol, the Genesis Claims Tree will contain at least a claim of authorization of the Operational key, that allows operating in the name of identity.
 <!-- (identities operated by Smart Contracts are not specified in this version). -->
</p>
<p>While an identity doesn't add, update or revoke claims after the Genesis State, its identity state does not need to be published on the blockchain, and the <code>Genesis Claims</code> can be verified directly against the <code>Genesis ID</code>, as it is built by the Merkle Root that holds that claims.</p>
<blockquote>
<p>NOTE: The Genesis ID is calculated with the Identity State as a hash of Genesis Claims Tree Root, an empty Revocation Tree Root and an empty Roots Tree Root.</p>
</blockquote>
<h4 id="identifier-format">Identifier format</h4>
<p>The Identifier of an identity is determined by the identity type and the <code>Genesis Identity State</code>, what we call the <code>Genesis ID</code>. This is built by creating a MerkleTree that holds the initial state claims, calculating its Root, hashing it together with an empty Revocation Tree Root and an empty Roots Tree Root. Then taking the first 27 bytes of the result and adding 2 bytes at the beginning to specify the identity type, and 2 bytes at the end for checksum. In sum, the identifier is a byte array of 31 bytes, encoded in base58.</p>
<p>The <strong>identity type</strong> specifies the specs that the identity follows, such as the hash function used by the identity. In this way, when the hash function changes, the identifiers of the identities will change, allowing to identify of which type and protocol is one identity.</p>
<p>Identifier structure:
- <code>ID</code> (genesis): base58 [ <code>type</code> | <code>genesis_state</code> | <code>checksum</code> ]
    - <code>type</code>: 2 bytes specifying the type
    - <code>genesis_state</code>: first 27 bytes from the identity state (using the genesis claim merkle tree)
    - <code>checksum</code>: addition (with overflow) of all ID bytes Little Endian 16 bits ( [ <code>type</code> | <code>genesis_state</code> ] )</p>
<h4 id="identity-state">Identity state</h4>
<p>The <strong>identity states</strong> are published on the blockchain under the identity identifier, anchoring the state of the identity with the timestamp when it is published. In this way, the claims of the identity can be proved against the anchored identity state at a certain timestamp. To transition from a state to another one, identities follow the transition functions.</p>
<p>The identity states can be published on the blockchain <strong>directly</strong> performing the transaction to publish the root, or <strong>indirectly</strong> using a Relay. </p>
<!-- The indirect method is described in the section [Indirect Identities](#Indirect-identities). -->
<p>The <code>genesis state</code> is the initial state of any identity, and does not need to be published in the blockchain, as the claims under it can be verified against the identity identifier itself (that contains that identity state).</p>
<p><img alt="" src="../../imgs/identity_state_transition.png"/></p>
<h4 id="identity-state-transition-function">Identity state transition function</h4>
<p>The <code>ITF</code> (Identity state Transition Function) is verified each time that the State is updated in order to ensure that the identities follow the protocol when updating the state.</p>
<p>Identity MerkleTree is a sparse binary tree, that only allows the addition of leaves (no edition nor deletion), and to add new claims, update through versions and revoke, needs to be done according to the <code>ITF</code>. To ensure this we use Zero-Knowledge proofs, in a way that when an identity is publishing a new state to the Smart Contract, also sends a zero-knowledge proof (<code>π</code>) proving that the <code>ϕ</code> is satisfied following the <code>ITF</code>. In this way, all the identity states published on the blockchain are validated to be following the protocol.</p>
<blockquote>
<p>In the initial version of the implementation there will not be checks that trees are append-only in the Smart Contract due to the complex computation needed to generate zk-proofs of multiple claim additions, which is needed for scalability.</p>
</blockquote>
<p>The full circuit can be found here: https://github.com/iden3/circuits/blob/master/circuits/idState.circom</p>
<!--
##### Direct identity ITF_min

###### Addition of non-updatable claim
Prove that a leaf in the MT (claim) is only added but never deleted nor changed

- `R_i -> leaf_claim==0`
- `R_i+1 -> leaf_claim==claim`
> 2 MerkleProofs with same siblings

###### Addition of claim with versions
- `v0`
    - `R_i -> leaf_claim_v0==0`
    - `R_i+1 -> leaf_claim_v0==claim_v0`
> 2 MerkleProofs with same siblings

If an updatable claim is added to the MT with version `v!=0`, claim version `v-1` must already exist in the MT

- `v_n+1`
    - `R_i -> leaf_claim_vn==claim_vn`
    - `R_i -> leaf_claim_vn+1==0`
    - `R_i+1 -> leaf_claim_vn+1==claim_vn+1`
> 1 MerkleProof with siblings
> 2 MerkleProof with same siblings
-->
<!-- ##### Indirect identity ITF_min
==TODO== -->
<h3 id="identity-ownership">Identity Ownership</h3>
<p>We prove the identity ownership inside a zkSNARK proof. This means that the user can generate a zk-proof that he/she knows a <code>private key</code> corresponding to <code>operational key for authorization</code> claim added to Claims Tree, without revealing the <code>claim</code> and its position. This is codified inside a circom circuit, which can be used in other circuits (such as the <code>id state update</code> circuit).</p>
<p>The full circuit can be found here: https://github.com/iden3/circuits/blob/master/circuits/idOwnershipBySignature.circom</p>
<h3 id="identity-key-rotation">Identity key rotation</h3>
<p>An identity can self-issue and revoke many <code>private keys</code> and corresponding <code>claims</code> of the type <code>operational key authorization</code> enabling key rotation in that way. To support verification of such claims identity state should be publicly available in the blockchain. An identity can publish the state to blockchain directly or via the Relay.</p>
<p>Any private key, for which a corresponding claim exists in the identity claims tree and does not exist in the identity revocation tree, can be used to create a zero-knowledge proof of valid credentials. Such proof should pass verification by a verifier as it is able to check the latest identity state in the blockchain.</p>
<p>In the same way, any valid and non-revoked identity private key can be used to create a valid zk_proof for identity state transition function.</p>
<p>Note: An identity may lose some privacy as far as it needs to disclose its state to a verifier, which can track all the proofs of the same identity in that way. However, this can be mitigated if the identity state is published to the blockchain via the Relay. In this case, only the Relay state needs to be disclosed to a verifier.</p>
<!-- ==TBD: Identity recovery procedure in case of a private key and state database loss== -->
<h3 id="identity-revocation">Identity Revocation</h3>
<p>When identity revokes all <code>claims</code> of the type <code>operational key authorization</code>, it is considered as <code>revoked</code>, because this identity can no longer create proofs.</p>
<h2 id="interaction-between-identity-and-claims">Interaction between Identity and Claims</h2>
<h3 id="identity-state-update">Identity State Update</h3>
<p>The Identity State Update is the procedure used to update information about
what this Identity claims. This involves three different actions:
- Add a Claim
- Update Updatable Claim (by incrementing the version and changing the Claim value part)
- Revoke a Claim</p>
<!--
The Identity State Update can be generalized as an `ITF_min` (minor Identity Transition
Function) that performs a minor update of the Identity (where a minor update
only concerns the Claims of the Identity but not the Identity itself).
-->
<p>Definitions</p>
<ul>
<li><code>IdS</code>: Identity State</li>
<li><code>ClT</code>: Claims Tree<ul>
<li><code>ClR</code>: Claims Tree Root</li>
</ul>
</li>
<li><code>ReT</code>: Revocation Tree<ul>
<li><code>ReR</code>: Revocation Tree Root</li>
</ul>
</li>
<li><code>RoT</code>: Roots Tree<ul>
<li><code>RoR</code>: Roots Tree Root</li>
</ul>
</li>
</ul>
<p>The <code>IdS</code> (Identity State) is calculated concatenating the roots of the three user trees:
- <code>IdS</code>: <code>H(ClR || ReR || RoR)</code>
    - Where <code>H</code> is the Hash function defined by the Identity Type (for example Poseidon)</p>
<p>All trees are SMT (Sparse Merkle Tree) and use the hash function defined by the Identity Type.
- Leaves in <code>ClT</code> (Claims Tree) are Claims ((4 + 4) * 253 bits = 253B)</p>
<pre><code>See Claims Structure
</code></pre>
<ul>
<li>Leaves in <code>ReT</code> (Revocation Tree) are Revocation Nonce + Version (64 + 32 bits = 12B)</li>
</ul>
<pre><code>Revocation Tree Leaf:
leaf: [ 64 bits ] revocation nonce
      [ 32 bits ] version
      [157 bits ] 0
</code></pre>
<ul>
<li>Leaves in <code>RoT</code> (Roots Tree) are tree Roots (from the Claims Tree) (253 bits ≈ 32B)</li>
</ul>
<pre><code>Roots Tree Leaf:
leaf: [253 bits ] tree root
</code></pre>
<p><img alt="" src="https://i.imgur.com/3ZS1ZvJ.png"/></p>
<blockquote>
<p>Identity State Diagram for Direct Identity</p>
</blockquote>
<p>As seen in the diagram, only the <code>IdS</code> is stored in the Blockchain.  In order
to save stored bytes in the blockchain, it is desirable that only one "hash"
representing the current state of the Identity is stored in the Smart Contract.
This one "hash" is the <code>IdS</code> (Identity State), which is linked to a timestamp
and a block in the blockchain.</p>
<p>All the public data must be made available for any Holder so that
they can build fresh merkle tree proofs of both the <code>ReT</code> and <code>RoT</code>.  This
allows the Holder to:</p>
<ol>
<li>Prove recent non-revocation / "current" version without interaction with the issuer.</li>
<li>Hide a particular <code>ClR</code> from all the <code>ClR</code>s, to avoid allowing the issuer to
   discover a Claim hidden behind a ZK proof. For this purpose <code>ClR</code> added to <code>RoR</code></li>
</ol>
<p>The place and method to access the publicly available data is specified in the
Identities State Smart Contract. Two possible initial options are:</p>
<ul>
<li>IPFS, by adding a link to an <a href="https://docs.ipfs.io/guides/concepts/ipns/">IPNS address</a> (example:
  <code>ipfs://ipns/QmSrPmbaUKA3ZodhzPWZnpFgcPMFWF4QsxXbkWfEptTBJd</code>) which contains
  a standardized structure of the data.</li>
<li>HTTPS, by adding a link to an HTTPS endpoint (example:
  <code>https://kyc.iden3.io/api/v1/public-state/aabbccdd</code> which offers the data
  following a standardized API.</li>
</ul>
<h4 id="publish-claims">Publish Claims</h4>
<p>Publishing a Claim involves first adding a new leaf to the <code>ClT</code>, which updates
the Identity <code>ClR</code>.  Claims can be optionally published in batches, adding more
than one leaf to the <code>ClT</code> in a single transaction.  After the <code>ClT</code> has been
updated, the Identity must follow an Identity State Update so that anyone is
able to verify the newly added Claims.  This involves adding the new <code>ClR</code> to
the <code>RoT</code> which in turn will update the <code>RoR</code>.  Afterwards, the new <code>IdS</code> is
calculated and through a transaction it is updated in the Identities State
Smart Contract (from now on, referred to as "the Smart Contract") in the
blockchain.  Once the updated <code>IdS</code> is in the Smart Contract, anyone can verify
the validity of the newly added Claims.</p>
<p>The updating procedure of the <code>IdS</code> in the Smart Contract can be achieved
through the following means with the following properties:
- <em>Bad scalability (no batch), good privacy, correctness</em>: The identity uploads
  the new <code>IdS</code> to the Smart Contract, with a proof of a correct transition from
  the old <code>IdS</code> to the new one. Only one claim is added to the <code>ClT</code> in the
  transition.
- <em>Good scalability (batch), good privacy, correctness</em>: Same as before, but
  many claims are added (batch) in the transition (with a single proof for all
  newly added claims)
- <em>Good scalability (batch), good privacy, no correctness</em>: The identity uploads
  the new <code>IdS</code> to the Smart Contract, without proving correctness on the
  transition.</p>
<p>The correctness properties mentioned here are the following:
- Revocation of a Claim can't be later undone
- Updatable Claims are only updated with increasing versions, and only one
  version is valid at a time.</p>
<p>The choice of having correctness guarantees or not is specified in the Identity
Type, so that any Verifier knows about the guarantees provided by the protocol
for the Issuer Claims.</p>
<blockquote>
<p>NOTE: Good scalability refers to the verification process and the costs related to the Smart Contract. Batching with zkSNARKs can have a high computation load to the prover.</p>
</blockquote>
<h4 id="revocation-tree">Revocation tree</h4>
<p>Sometimes it's desirable for an Identity to invalidate some statement made
through a Claim.  For regular Claims, this involves revoking, a process that's
ideally irreversible, and allows any verifier to be aware that an already
published Claim is made invalid by the Issuer Identity.  Similarly, for updatable
Claims, there must be a mechanism to invalidate old versions when a new one is
published.  Since confirming the current validity of a Claim is a parallel
process to confirming that a Claim was published at some point, the "current
validation" process can be separated.</p>
<p>Separating these two processes allows a design in which the <code>ClT</code> (Claim Tree)
remains private, but the revocation/version information is public, allowing a
holder to generate a fresh proof of "current validity" without requesting
access to the private <code>ClT</code>.</p>
<p>To achieve this, every Identity has a <code>ClT</code> (Claim Tree) and a separate <code>ReT</code>
(Revocation Tree).  While the claim tree would be private and only the root
public, the revocation tree would be entirely public.  The roots of both trees
(<code>ClT</code> and <code>ReT</code>) are linked via the <code>IdS</code> (Identity State) which is published
in the Smart Contract.  The revocation tree could be published in IPFS or any
other public storage system.</p>
<p>Proving that a claim is valid (and thus not revoked/updated) is separated into
two proofs:
1. Prove that the claim was issued at some time T (this proof is generated once
   by the issuer and uses a <code>IdS</code>-<code>ClR</code> at time T stored in the Smart Contract)
2. Prove that the claim has not been revoked/updated recently (this proof is
   generated by the holder with a recent <code>ReR</code> (Revocation Tree Root) by
   querying the public <code>ReT</code> (Revocation Tree), and verified against a recent
   <code>IdS</code>).</p>
<h4 id="revoke-claims">Revoke Claims</h4>
<p>In order to not reveal anything about the content of the claim in the
<code>ReT</code>, the Claim contains a revocation nonce in the value part, which
is added as a leaf in the <code>ReT</code> to revocate the Claim.</p>
<p>In order to forbid undoing revocation of a claim, the <code>ReT</code> needs to follow some
transition rules like <code>ClT</code>, enforced by a ZK proof (for space and verification
efficiency).</p>
<p>Apart from the revoking procedure, there's a method to define the validity of a
Claim based on expiration, by explicitly setting an expiration date in the
Claim (See Claim Structure).  Revoking and Expiration are compatible methods to
invalidate Claims.</p>
<h4 id="update-claims">Update Claims</h4>
<p>To update a Claim, first, a new Claim is added to the <code>ClT</code> with an increased version
value in the index position in the claim (notice that the previous version of the 
claim is not touched). Then, a leaf is added to the <code>ReT</code> containing the revocation
nonce and the maximum invalid version (that is, all Claims with that nonce and
version equal or lower to the one in the leaf are invalid).  This means that
when a Claim is updated, the same revocation nonce is used in the Claim.</p>
<p>In order to forbid downgrading the version of a Claim, and forcing to have only
one valid updatable Claim at a time, the <code>ReT</code> needs to follow some transition
rules like the <code>ClT</code> does, enforced by a ZK proof (for space and verification
efficiency).</p>
<p>Updating and Revoking are compatible methods to invalidate Claims: an updatable
Claim can be revoked, meaning that no future (or past) updates will be valid.</p>
<p>In case when a claim needs to be revoked completely, without possibility to update. 
The maximum version and the revocation nonce should be added to <code>ReT</code></p>
<h3 id="prove-claims-credentials">Prove Claims (Credentials)</h3>
<p>Nomenclature
- MTP: Merkle Tree Proof. The list of siblings in a path from a leaf to the
  root.</p>
<h4 id="prove-that-a-claim-was-issued-at-time-at-least-t">Prove that a claim was issued at time at least t</h4>
<ul>
<li>Requires proving a link between the Claim and an <code>IdS_t</code> (Identity State at
  time t) published in the Smart Contract.  This proof requires:<ul>
<li>Claim</li>
<li>t</li>
<li>MTP Claim -&gt; <code>ClR_t</code></li>
<li><code>RoR_t</code> (Roots Tree at time t)</li>
<li><code>ReR_t</code> (Revocation Tree Root at time t)</li>
<li><code>IdS_t</code></li>
</ul>
</li>
</ul>
<p>Where <code>t</code> is any time.</p>
<h4 id="prove-that-the-claim-is-currently-valid">Prove that the claim is currently valid</h4>
<h5 id="prove-that-a-claim-hasnt-been-recently-revoked">Prove that a claim hasn't been recently revoked</h5>
<p>Where <code>t</code> is a recent time.</p>
<ul>
<li>Requires proving the inexistence of a link between the Claim revocation nonce
  and a recent <code>IdS_t</code> (<code>t</code> must be recent according to the verifier
  requirements [1]) published in the Smart Contract.  This proof requires:<ul>
<li>Claim (Nonce)</li>
<li>t</li>
<li>MTP !Nonce -&gt; <code>ReR_t</code></li>
<li><code>ClR_t</code></li>
<li><code>RoR_t</code></li>
<li><code>IdS_t</code></li>
</ul>
</li>
</ul>
<p>[1] The verifier needs to decide a time span to define how recent the
<code>IdS_t</code> used in the proof needs to be.  Always requiring the current <code>IdS</code>
could lead to data races, so it's better to require an <code>IdS</code> that is no more
than X hours old.</p>
<h5 id="proof-of-last-version">Proof of last version</h5>
<p>This is very similar to proving that a claim hasn't been recently revoked,
except that not only the nonce in the claim is checked, but also the version.</p>
<ul>
<li>Requires proving the inexistence of a link between the Claim revocation nonce</li>
<li>version and a recent <code>IdS_t</code> (<code>t</code> must be recent according to the verifier
    requirements [1]) published in the Smart Contract.  This proof requires:<ul>
<li>Claim (Nonce, Version)</li>
<li>t</li>
<li>MTP !(Nonce, Version) -&gt; <code>ReR_t</code></li>
<li><code>ClR_t</code></li>
<li><code>RoR_t</code></li>
<li><code>IdS_t</code></li>
</ul>
</li>
</ul>
<p>Where <code>t</code> is a recent time.</p>
<h5 id="proof-of-non-expiration">Proof of non-Expiration</h5>
<p>A Claim can be expirable by setting the expiration flag in the options and
specifying an expiration date in unix timestamp format in the corresponding
claim value part (see Claim Format).</p>
<h4 id="zero-knowledge-proof-of-valid-credential">Zero-Knowledge proof of valid Credential</h4>
<p>A Zero-Knowledge proof allows hiding some information about a Claim while
proving that it was issued by a particular Identity and that it's currently
valid. The same checks performed in the following sections are done:
- Prove that a claim was issued at time at least t
- Prove that the claim is currently valid</p>
<p>In the proof that shows "that a claim was issued at time at least t" there's an
additional part that is added to hide the particular <code>IdS_t1</code> that is used (in
order to hide the Claim from the Issuer, See Appendix Title 2).  The proof then
requires:
    - Claim
    - t
    - MTP Claim -&gt; <code>ClR_t1</code>
    - <code>RoR_t1</code> (Roots Tree at time t1)
    - <code>ReR_t1</code> (Revocation Tree Root at time t1)
    - <code>IdS_t1</code>
    - MTP <code>ClR_t1</code> -&gt;<code>RoR_t2</code>
    - <code>ClR_t2</code> (Claims Tree Root at time t2)
    - <code>ReR_t2</code> (Revocation Tree Root at time t2)
    - <code>IdS_t2</code></p>
<p>Where <code>t1</code> is a any time and <code>t2</code> is a recent time.</p>
<p>The full circuit can be found at: https://github.com/iden3/circuits/blob/master/circuits/credential.circom</p>
<h2 id="identities-communications">Identities Communications</h2>
<h3 id="issuer-holder-credential-request-procedure">Issuer - Holder (Credential Request procedure)</h3>
<p>The same procedure works for already issued claims, and new claims: 
- The Issuer has issued a claim linking a property to the Holder, and the Holder requests the credential of the issued claim.
- The Holder requests the issue of a new claim linking a property to the Holder.</p>
<blockquote>
<p>NOTE: In http, use polling to resolve the "Future".  In async messaging, request the resolution of the "Future" and wait for the reply.</p>
</blockquote>
<h4 id="direct-claims">Direct Claims</h4>
<div class="mermaid">sequenceDiagram
    Holder-&gt;&gt;IssuerServer: req. Credential + auth?
    IssuerServer-&gt;&gt;IssuerServer: Auto/Manual check
    IssuerServer-&gt;&gt;IssuerServer: Add Claim to MT
    IssuerServer-&gt;&gt;Holder: Future(Credential)
    IssuerServer-&gt;&gt;SmartContract: Publish Root
    SmartContract-&gt;&gt;IssuerServer: Ok
    Holder-&gt;&gt;IssuerServer: Poll(Future(Credential))
    IssuerServer-&gt;&gt;Holder: Credential
</div>
<h5 id="indirect-claims">Indirect Claims</h5>
<div class="mermaid">sequenceDiagram
    Holder-&gt;&gt;IssuerClient: req. Credential
    IssuerClient-&gt;&gt;IssuerClient: Auto/Manual check
    IssuerClient-&gt;&gt;IssuerClient: Add Claim to MT
    IssuerClient-&gt;&gt;Relay: req. Credential (SetRoot)
    Relay-&gt;&gt;Relay: Add Claim to MT
    Relay-&gt;&gt;IssuerClient: Future(Credential1)
    IssuerClient-&gt;&gt;Holder: Credential0, Future(Credential1)
    Relay-&gt;&gt;SmartContract: Publish Root
    SmartContract-&gt;&gt;Relay: Ok
    Holder-&gt;&gt;Relay: Poll(Future(Credential1))
    Relay-&gt;&gt;Holder: Credential
</div>
<h3 id="holder-verifier">Holder - Verifier</h3>
<ul>
<li>Verifier requests a claim (or in general, a proof that involves some claims).</li>
<li>Holder shows a proof of the claim (or in general, a proof that involves some claims) to the Verifier.</li>
</ul>
<div class="mermaid">sequenceDiagram
    participant A
    Exchange_SC-&gt;&gt;Exchange_SC: define CR with CRL
    A-&gt;&gt;Exchange_SC: get CR
    Exchange_SC-&gt;&gt;A: CR
    A-&gt;&gt;A: build proof using Claim DB
    A-&gt;&gt;Exchange_SC: proof
    Exchange_SC-&gt;&gt;Exchange_SC: validate
    Exchange_SC-&gt;&gt;Exchange_SC: action
    Exchange_SC-&gt;&gt;A: result
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: Getting started" class="md-footer__link md-footer__link--prev" href="../../basics/getting-started/" rel="prev">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</div>
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Previous
              </span>
              Getting started
            </div>
</div>
</a>
<a aria-label="Next: Structure" class="md-footer__link md-footer__link--next" href="../claims-structure/" rel="next">
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Next
              </span>
              Structure
            </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
            Material for MkDocs
          </a>
</div>
<div class="md-footer-social">
<a class="md-footer-social__link" href="https://t.me/iden3io" rel="noopener" target="_blank" title="t.me">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><path d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm121.8 169.9-40.7 191.8c-3 13.6-11.1 16.9-22.4 10.5l-62-45.7-29.9 28.8c-3.3 3.3-6.1 6.1-12.5 6.1l4.4-63.1 114.9-103.8c5-4.4-1.1-6.9-7.7-2.5l-142 89.4-61.2-19.1c-13.3-4.2-13.6-13.3 2.8-19.7l239.1-92.2c11.1-4 20.8 2.7 17.2 19.5z"></path></svg>
</a>
<a class="md-footer-social__link" href="https://github.com/iden3/docs" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
</a>
<a class="md-footer-social__link" href="https://iden3.io/" rel="noopener" target="_blank" title="iden3.io">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M0 3.75C0 2.784.784 2 1.75 2h20.5c.966 0 1.75.784 1.75 1.75v16.5A1.75 1.75 0 0 1 22.25 22H1.75A1.75 1.75 0 0 1 0 20.25V3.75zm1.75-.25a.25.25 0 0 0-.25.25V5.5h4v-2H1.75zM7 3.5v2h4v-2H7zm5.5 0v2h10V3.75a.25.25 0 0 0-.25-.25H12.5zm10 3.5h-21v13.25c0 .138.112.25.25.25h20.5a.25.25 0 0 0 .25-.25V7z" fill-rule="evenodd"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.tracking"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.e99e714c.min.js", "version": null}</script>
<script src="../../assets/javascripts/bundle.bc35569b.min.js"></script>
<script src="../../javascripts/mathjax.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script src="https://unpkg.com/mermaid@8.8.0/dist/mermaid.min.js"></script><script>mermaid.initialize({});</script></body>
</html>